!function(){function splitPhrase(phrase){return phrase=phrase.replace(/\s{2,}/g," "),phrase=phrase.replace(/^\s+|\s+$/g,""),phrase.match(/\s/)?(debug&&console.log("Multiple terms detected."),phrase.split(" ")):(debug&&console.log("One term detected."),phrase)}function matchTerm(term){debug&&console.log("Matching '"+term+"'...");var key,value,parts=["","",""];for(key in endings)if(endings.hasOwnProperty(key)&&(value=endings[key],term.match(value))){debug&&console.log("Term matched with ending '"+key+"'.");var termHasTone=term.match(/1|2|3|4/);termHasTone&&term.indexOf(termHasTone)+1<term.length&&(term=term.substring(0,term.indexOf(Number(termHasTone))+1)),parts=term.split(key),parts.push(key)}return""===parts[0]&&""===parts[1]&&""===parts[2]&&debug&&console.log("No matches."),parts}function reconstructEnding(ending,tone){if(""!==tone&&""!==ending){debug&&console.log("Reconstructing ending '"+ending+"' with Tone "+tone+"...");var markedLetter,parts,reconstructedEnding;ending.match(/.*a(?![aeiouü])/)?(markedLetter=convertLetter("a"+tone),parts=ending.split("a"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*ai(?![aeiouü])/)?(markedLetter=convertLetter("a"+tone),parts=ending.split("a"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*ao(?![aeiouü])/)?(markedLetter=convertLetter("a"+tone),parts=ending.split("a"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*e(?![aeiouü])/)?(markedLetter=convertLetter("e"+tone),parts=ending.split("e"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*ei(?![aeiouü])/)?(markedLetter=convertLetter("e"+tone),parts=ending.split("e"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*i(?![aeiouü])/)?(markedLetter=convertLetter("i"+tone),parts=ending.split("i"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*ia(?![aeiouü])/)?(markedLetter=convertLetter("a"+tone),parts=ending.split("a"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*iao(?![aeiouü])/)?(markedLetter=convertLetter("a"+tone),parts=ending.split("a"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*ie(?![aeiouü])/)?(markedLetter=convertLetter("e"+tone),parts=ending.split("e"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*io(?![aeiouü])/)?(markedLetter=convertLetter("o"+tone),parts=ending.split("o"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*iu(?![aeiouü])/)?(markedLetter=convertLetter("u"+tone),parts=ending.split("u"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*o(?![aeiouü])/)?(markedLetter=convertLetter("o"+tone),parts=ending.split("o"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*ou(?![aeiouü])/)?(markedLetter=convertLetter("o"+tone),parts=ending.split("o"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*u(?![aeiouü])/)?(markedLetter=convertLetter("u"+tone),parts=ending.split("u"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*ua(?![aeiouü])/)?(markedLetter=convertLetter("a"+tone),parts=ending.split("a"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*uai(?![aeiouü])/)?(markedLetter=convertLetter("a"+tone),parts=ending.split("a"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*ue(?![aeiouü])/)?(markedLetter=convertLetter("e"+tone),parts=ending.split("e"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*ui(?![aeiouü])/)?(markedLetter=convertLetter("i"+tone),parts=ending.split("i"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*uo(?![aeiouü])/)?(markedLetter=convertLetter("o"+tone),parts=ending.split("o"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*v(?![aeiouü])/)?(markedLetter=convertLetter("v"+tone),parts=ending.split("v"),reconstructedEnding=parts[0]+markedLetter+parts[1]):ending.match(/.*ü(?![aeiouü])/)&&(markedLetter=convertLetter("ü"+tone),parts=ending.split("ü"),reconstructedEnding=parts[0]+markedLetter+parts[1]),debug&&console.log("Created ending '"+reconstructedEnding+"'.")}else reconstructedEnding=ending,debug&&console.log("Didn't create a new ending.");return reconstructedEnding}function convertLetter(letter){var convertedLetter;switch(letter){case"a1":convertedLetter="ā";break;case"a2":convertedLetter="á";break;case"a3":convertedLetter="ǎ";break;case"a4":convertedLetter="à";break;case"e1":convertedLetter="ē";break;case"e2":convertedLetter="é";break;case"e3":convertedLetter="ě";break;case"e4":convertedLetter="è";break;case"i1":convertedLetter="ī";break;case"i2":convertedLetter="í";break;case"i3":convertedLetter="ǐ";break;case"i4":convertedLetter="ì";break;case"o1":convertedLetter="ō";break;case"o2":convertedLetter="ó";break;case"o3":convertedLetter="ǒ";break;case"o4":convertedLetter="ò";break;case"u1":convertedLetter="ū";break;case"u2":convertedLetter="ú";break;case"u3":convertedLetter="ǔ";break;case"u4":convertedLetter="ù";break;case"v1":convertedLetter="ǖ";break;case"v2":convertedLetter="ǘ";break;case"v3":convertedLetter="ǚ";break;case"v4":convertedLetter="ǜ";break;case"ü1":convertedLetter="ǖ";break;case"ü2":convertedLetter="ǘ";break;case"ü3":convertedLetter="ǚ";break;case"ü4":convertedLetter="ǜ"}return convertedLetter}var debug;window.Pinyinize={intoMarks:function(pinyinWithNumbers,debugMode){debug=debugMode||!1;var termParts,convertedEnding,convertedTerm,phrases=splitPhrase(pinyinWithNumbers),pinyinWithMarks="";if("string"!=typeof phrases){var key,value;for(key in phrases)phrases.hasOwnProperty(key)&&(value=phrases[key],termParts=matchTerm(value),convertedEnding=reconstructEnding(termParts[2],termParts[1]),convertedTerm=termParts[0]+convertedEnding,pinyinWithMarks=""!==termParts[1]?""!==pinyinWithMarks?pinyinWithMarks=pinyinWithMarks+" "+convertedTerm:convertedTerm:""!==pinyinWithMarks?pinyinWithMarks+" "+value:value)}else termParts=matchTerm(pinyinWithNumbers),convertedEnding=reconstructEnding(termParts[2],termParts[1]),convertedTerm=termParts[0]+convertedEnding,pinyinWithMarks=""!==convertedTerm?convertedTerm:pinyinWithNumbers;return pinyinWithMarks}};var endings={a:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*a(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*a$|^a(?=[1-4](?!\w))/,ai:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*ai(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*ai$|^ai(?=[1-4](?!\w))/,an:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*an(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*an$|^an(?=[1-4](?!\w))/,ang:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*ang(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*ang$|^ang(?=[1-4](?!\w))/,ao:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*ao(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*ao$|^ao(?=[1-4](?!\w))/,e:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*e(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*e$|^e(?=[1-4](?!\w))/,ei:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*ei(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*ei$|^ei(?=[1-4](?!\w))/,en:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*en(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*en$|^en(?=[1-4](?!\w))/,eng:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*eng(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*eng$|^eng(?=[1-4](?!\w))/,er:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*er(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*er$|^er(?=[1-4](?!\w))/,i:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*i(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*i$|^i(?=[1-4](?!\w))/,ia:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*ia(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*ia$|^ia(?=[1-4](?!\w))/,ian:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*ian(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*ian$|^ian(?=[1-4](?!\w))/,iang:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*iang(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*iang$|^iang(?=[1-4](?!\w))/,iao:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*iao(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*iao$|^iao(?=[1-4](?!\w))/,ie:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*ie(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*ie$|^ie(?=[1-4](?!\w))/,"in":/[bcdfghjklmnpqrstwxyz][^aeiouüv]*in(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*in$|^in(?=[1-4](?!\w))/,ing:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*ing(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*ing$|^ing(?=[1-4](?!\w))/,io:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*io(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*io$|^io(?=[1-4](?!\w))/,iong:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*iong(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*iong$|^iong(?=[1-4](?!\w))/,iu:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*iu(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*iu$|^iu(?=[1-4](?!\w))/,o:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*o(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*o$|^o(?=[1-4](?!\w))/,ong:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*ong(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*ong$|^ong(?=[1-4](?!\w))/,ou:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*ou(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*ou$|^ou(?=[1-4](?!\w))/,u:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*u(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*u$|^u(?=[1-4](?!\w))/,ua:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*ua(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*ua$|^ua(?=[1-4](?!\w))/,uai:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*uai(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*uai$|^uai(?=[1-4](?!\w))/,uan:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*uan(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*uan$|^uan(?=[1-4](?!\w))/,uang:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*uang(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*uang$|^uang(?=[1-4](?!\w))/,ue:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*ue(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*ue$|^ue(?=[1-4](?!\w))/,ui:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*ui(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*ui$|^ui(?=[1-4](?!\w))/,un:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*un(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*un$|^un(?=[1-4](?!\w))/,uo:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*uo(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*uo$|^uo(?=[1-4](?!\w))/,v:/[bcdfghjklmnpqrstwxyz][^aeiouüv]*v(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*v$|^v(?=[1-4](?!\w))/,"ü":/[bcdfghjklmnpqrstwxyz][^aeiouüv]*ü(?=[1-4](?!\w))|[bcdfghjklmnpqrstwxyz][^aeiouüv]*ü$|^ü(?=[1-4](?!\w))/}}();